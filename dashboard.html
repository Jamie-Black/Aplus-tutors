<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aplus Tutors | Student Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="dashboard.css">
</head>

<body class="dashboard-body">
<header>
  <h1 style="text-align: center;">
    Welcome, <span id="studentName"></span>
  </h1>

  <!-- NEW: Show department under name -->
  <p style="margin-top:5px; font-size:14px; color:#ffecec;">
    Department: <span id="studentDept"></span>
  </p>

  <br />
  <a style="color: white; font-size:12px;" href="profile.html">View and edit your profile</a>
</header>

<section class="notificatbar">
  <div class="icon-card" onclick="togglePanel('notificationsPanel')">
    <i class="fas fa-bell"></i><span class="dot"></span>
  </div>
  <div class="icon-card" onclick="togglePanel('deadlinesPanel')">
    <i class="fas fa-calendar-alt"></i><span class="dot"></span>
  </div>
  <div class="icon-card" onclick="togglePanel('learningPanel')">
    <i class="fas fa-book-reader"></i><span class="dot"></span>
  </div>
  <div class="icon-card" onclick="togglePanel('leaderboardPanel')">
    <i class="fas fa-trophy"></i><span class="dot"></span>
  </div>
</section>

<section class="motivation">
  <h2>Keep Going!</h2>
  <p id="motivationText">Loading inspiration...</p>
</section>

<div class="top-panel">
  <div id="notificationsPanel" class="panel">
    <span class="close-btn" onclick="closePanel('notificationsPanel')">&times;</span>
    <h3>Notifications</h3><ul id="notificationsList"></ul>
  </div>
  <div id="deadlinesPanel" class="panel">
    <span class="close-btn" onclick="closePanel('deadlinesPanel')">&times;</span>
    <h3>Deadlines</h3><ul id="deadlinesList"></ul>
  </div>
  <div id="learningPanel" class="panel">
    <span class="close-btn" onclick="closePanel('learningPanel')">&times;</span>
    <h3>Suggested Learning</h3><ul id="learningList"></ul>
  </div>
  <div id="leaderboardPanel" class="panel">
    <span class="close-btn" onclick="closePanel('leaderboardPanel')">&times;</span>
    <h3>Leaderboard</h3><ul id="leaderboardList"></ul>
  </div>
</div>

<section class="dashboard-grid">
  <div class="card" onclick="goTo('study.html')">
    <h3>Study Room</h3><p>Read and study subject topics, do exercises and complete tasks.</p>
  </div>
  <div class="card" onclick="goTo('assignment.html')">
    <h3>My Assignments</h3><p>View and submit your assignments.</p>
  </div>
  <div class="card" onclick="goTo('studentquiz.html')">
    <h3>My Quizzes</h3><p>Test your knowledge and boost confidence.</p>
  </div>
  <div class="card" onclick="goTo('studentcbt.html')">
    <h3>My CBT</h3><p>Take timed tests and prepare for CBT exams.</p>
  </div>
  <div class="card" onclick="goTo('classroom.html')">
    <h3>Video Lessons</h3><p>Comprehensive topics explained clearly.</p>
  </div>
  <div class="card" onclick="goTo('resources.html')">
    <h3>My Resources</h3><p>Access notes, past questions, and materials.</p>
  </div>
  <div class="card" onclick="goTo('progress.html')">
    <h3>My Progress</h3><p>Track your academic growth and performance.</p>
  </div>
  <div class="card" onclick="goTo('studentblog.html')">
    <h3>My blog</h3><p>Motivate yourself and get latest academic information</p>
  </div>
  <button class="logout-btn" onclick="logout()">Logout</button>
</section>

<footer>&copy; 2021 Aplus Tutors</footer>

<script src="notification.js"></script>
<script>
const storedUser = JSON.parse(localStorage.getItem("loggedInUser"));
if(!storedUser) location.href="student-login.html";
else {
  document.getElementById("studentName").textContent = storedUser.fullName;

  // Load department
  let dept = storedUser.department || localStorage.getItem("userDepartment") || "Not set";
  document.getElementById("studentDept").textContent = dept;
}


document.getElementById("motivationText").textContent=
  motivationQuotes[Math.floor(Math.random()*motivationQuotes.length)];

const readFlags={notifications:false,deadlines:false,learning:false,leaderboard:false};
const dots={
  notifications:document.querySelector(".fa-bell").closest(".icon-card").querySelector(".dot"),
  deadlines:document.querySelector(".fa-calendar-alt").closest(".icon-card").querySelector(".dot"),
  suggestedLearning:document.querySelector(".fa-book-reader").closest(".icon-card").querySelector(".dot"),
  leaderboard:document.querySelector(".fa-trophy").closest(".icon-card").querySelector(".dot")
};
function populateList(id,items){
  const ul=document.getElementById(id);
  ul.innerHTML=items.length?items.map(i=>`<li>${i}</li>`).join(''):"<li>No updates</li>";
}
["notifications","deadlines","learning","leaderboard"].forEach(k=>{
  populateList(`${k}List`,eval(k));
});
function updateDots(){
  dots.notifications.style.display=(notifications.length&&!readFlags.notifications)?"block":"none";
  dots.deadlines.style.display=(deadlines.length&&!readFlags.deadlines)?"block":"none";
  dots.learning.style.display=(suggestedLearning.length&&!readFlags.learning)?"block":"none";
  dots.leaderboard.style.display=(leaderboard.length&&!readFlags.leaderboard)?"block":"none";
}
updateDots();
function panelIdToKey(id){
  return id.replace("Panel","");
}
function closeAllPanels(){
  document.querySelectorAll(".panel").forEach(p=>p.classList.remove("show"));
}
function togglePanel(id) {
  const panel = document.getElementById(id);
  const key = panelIdToKey(id);
  const isOpen = panel.classList.contains("show");

  // close all open panels first
  closeAllPanels();

  if(!isOpen){
    panel.classList.add("show");
    readFlags[key] = true;
    updateDots();

    // Ensure the panel stays within viewport
    const rect = panel.getBoundingClientRect();
    if(rect.right > window.innerWidth){
      panel.style.right = (window.innerWidth - rect.width - 10) + "px";
    } else {
      panel.style.right = "10px";
    }

    // optional: ensure it doesn't go above top
    if(rect.bottom > window.innerHeight){
      panel.style.top = (window.innerHeight - rect.height - 10) + "px";
    } else {
      panel.style.top = "60px";
    }
  }
}

function closePanel(id){document.getElementById(id).classList.remove("show");}
function goTo(p){location.href=p;}
function logout(){localStorage.removeItem("loggedInUser");location.href="student-login.html";}


</script>
</body>
</html>