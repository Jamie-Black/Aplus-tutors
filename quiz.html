<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aplus Tutors | Quizzes</title>
  <link rel="stylesheet" href="quiz.css">
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6">
    
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
  <header class="header">
    <h1>Multi-Subject Quizzes</h1>
  </header>

  <main class="quiz-container">

    <!-- Step 1: Student Info -->
    <div id="start-screen" class="screen active">
      <h2>Start Your Quiz</h2>
      <form id="start-form" class="main-form">
        <div class="form-group">
          <label for="student-name">Full Name:</label>
          <input type="text" id="student-name" required placeholder="Enter your full name">
        </div>
        <div class="form-group">
          <label for="student-email">Email Address:</label>
          <input type="email" id="student-email" required placeholder="your.email@example.com">
        </div>
        <button type="submit" class="primary-button">Continue</button>
      </form>
    </div>

    <!-- Step 2: Topic Selection -->
    <div id="topic-screen" class="screen">
      <h2>Select a Quiz Topic</h2>
      <div id="topic-list" class="topic-list"></div>
    </div>

    <!-- Step 3: Quiz Interface -->
    <div id="quiz-screen" class="screen">
      <h2 id="quiz-title"></h2>
      <div id="questions-area"></div>
      <button id="submit-quiz" class="primary-button" style="display: none;">Submit Quiz & Get Results</button>
    </div>

    <!-- Step 4: Results -->
    <div id="result-screen" class="screen">
      <h2>Quiz Results</h2>
      <p>Well done, <span id="result-name"></span>!</p>
      <div class="result-summary">
        <p>Subject: <span id="result-subject"></span></p>
        <p>Topic: <span id="result-topic"></span></p>
        <p>Score: <span id="result-score"></span></p>
        <p>Percentage: <span id="result-percentage"></span></p>
      </div>
      <a id="email-button" href="#" class="primary-button email-button" target="_blank">
        Email My Results to Instructor
      </a>
      <button class="secondary-button" onclick="window.location.reload();">Take Another Quiz</button>
    </div>

  </main>

  <footer>
    <p>&copy; 2025 Aplus Tutors</p>
  </footer>

  <script src="data.js"></script>

  <script>
    // Global State
    let studentInfo = { name: '', email: '', subject: '', topic: '' };
    let activeQuestions = [];
    let score = 0;

    // DOM Elements
    const startScreen = document.getElementById('start-screen');
    const topicScreen = document.getElementById('topic-screen');
    const quizScreen = document.getElementById('quiz-screen');
    const resultScreen = document.getElementById('result-screen');
    const topicList = document.getElementById('topic-list');
    const questionsArea = document.getElementById('questions-area');
    const submitButton = document.getElementById('submit-quiz');

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('start-form').addEventListener('submit', handleStart);
      submitButton.addEventListener('click', handleSubmitQuiz);
    });

    // Step 1: Handle Start
    function handleStart(e) {
      e.preventDefault();
      studentInfo.name = document.getElementById('student-name').value.trim();
      studentInfo.email = document.getElementById('student-email').value.trim();

      // Check if user exists (from data.js)
      const userFound = allowedUsers.some(
        user => user.name.toLowerCase() === studentInfo.name.toLowerCase() &&
                user.email.toLowerCase() === studentInfo.email.toLowerCase()
      );

      if (!userFound) {
        alert("Sorry, your name and email are not registered.");
        return;
      }

      startScreen.classList.remove('active');
      topicScreen.classList.add('active');
      loadTopics();
    }

    // Step 2: Load Topics
    function loadTopics() {
      topicList.innerHTML = '';
      for (const subject in quizData) {
        const subjectDiv = document.createElement('div');
        subjectDiv.classList.add('subject-section');
        const subjectTitle = document.createElement('h3');
        subjectTitle.textContent = subject;
        subjectDiv.appendChild(subjectTitle);

        quizData[subject].forEach(topicObj => {
          const topicCard = document.createElement('div');
          topicCard.classList.add('topic-card');
          topicCard.innerHTML = `
            <h4>${topicObj.topic}</h4>
            <p><strong>Subject:</strong> ${subject}</p>
            <p><strong>Questions:</strong> ${topicObj.questions.length}</p>
            <button class="primary-button" onclick="startQuiz('${subject}','${topicObj.topic}')">Start Quiz</button>
          `;
          subjectDiv.appendChild(topicCard);
        });

        topicList.appendChild(subjectDiv);
      }
    }

    // Step 3: Start Quiz
    function startQuiz(subject, topic) {
      studentInfo.subject = subject;
      studentInfo.topic = topic;

      const topicData = quizData[subject].find(t => t.topic === topic);
      activeQuestions = topicData.questions;

      topicScreen.classList.remove('active');
      quizScreen.classList.add('active');

      renderQuiz(activeQuestions);
    }

    // Step 4: Render Quiz
    function renderQuiz(questions) {
      document.getElementById('quiz-title').textContent = `${studentInfo.subject} - ${studentInfo.topic}`;
      questionsArea.innerHTML = '';

      questions.forEach((q, i) => {
        const div = document.createElement('div');
        div.classList.add('question-block');
        div.innerHTML = `
          <p class="question-number">Question ${i + 1} of ${questions.length}</p>
          <p class="question-text">${q.q}</p>
          <div class="options-group">
            ${q.options.map(opt => `
              <label><input type="radio" name="question-${i}" value="${opt}"> ${opt}</label>
            `).join('')}
          </div>
        `;
        questionsArea.appendChild(div);
      });

      if (typeof MathJax !== 'undefined') MathJax.typesetPromise([questionsArea]);
      submitButton.style.display = 'block';
    }

    // Step 5: Submit Quiz
    function handleSubmitQuiz() {
      score = 0;
      const total = activeQuestions.length;
      let allAnswered = true;

      activeQuestions.forEach((q, i) => {
        const selected = document.querySelector(`input[name="question-${i}"]:checked`);
        if (!selected) allAnswered = false;
        else if (selected.value === q.answer) score++;
      });

      if (!allAnswered) {
        alert("Please answer all questions before submitting.");
        return;
      }

      const percent = ((score / total) * 100).toFixed(0) + '%';
      displayResults(`${score} / ${total}`, percent, total);
    }

    // Step 6: Show Results
    function displayResults(scoreText, percent, total) {
      document.getElementById('result-name').textContent = studentInfo.name;
      document.getElementById('result-subject').textContent = studentInfo.subject;
      document.getElementById('result-topic').textContent = studentInfo.topic;
      document.getElementById('result-score').textContent = scoreText;
      document.getElementById('result-percentage').textContent = percent;

      const adminEmail = "your.admin.email@example.com";
      const subjectLine = `Quiz Results: ${studentInfo.subject} - ${studentInfo.topic}`;
      const body = `
Dear Aplus Tutors,

Here is my quiz result stat:
Name:  ${studentInfo.name}
Subject: ${studentInfo.subject}
Topic: ${studentInfo.topic}
Score: ${scoreText}
Percentage: ${percent}

Regards,
      `.trim();

      document.getElementById('email-button').href =
        `mailto:${studentInfo.email}?cc=${adminEmail}&subject=${encodeURIComponent(subjectLine)}&body=${encodeURIComponent(body)}`;

      quizScreen.classList.remove('active');
      resultScreen.classList.add('active');
    }
  </script>
</body>
    </html>
