<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aplus Tutors | Assignments</title>
  <link rel="stylesheet" href="assignment.css">
  
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    (function(){
      emailjs.init("YOUR_PUBLIC_KEY"); // üîë Replace with your EmailJS public key
    })();
  </script>
</head>
<body class="dashboard-body">

  <header>
    <h3><span id="studentName"></span></h3>
    <p id="studentEmail"></p>
    <h1 style="text-align: center; margin-top: 30px; font-size:30px;">My Assignments</h1>
  </header>

  <section id="assignmentsList" class="card-container"></section>

  <button class="logout-btn" onclick="logout()">Log Out</button>

  <script src="data.js"></script>
  <script>
    // ‚úÖ Load logged-in user
    const storedUser = JSON.parse(localStorage.getItem("loggedInUser"));
    if (!storedUser) {
      window.location.href = "login.html";
    } else {
      document.getElementById("studentName").textContent = storedUser.fullName;
      document.getElementById("studentEmail").textContent = storedUser.email;
    }

    // ‚úÖ Load assignments dynamically
    const container = document.getElementById("assignmentsList");

    if (typeof assignments !== "undefined" && assignments.length > 0) {
      assignments.forEach((task, index) => {
        const card = document.createElement("div");
        card.className = "card";

        // Create the questions list (if content is array)
        let questionsHTML = "";
        if (Array.isArray(task.content)) {
          questionsHTML = "<ol>";
          task.content.forEach(q => {
            questionsHTML += `<li>${q}</li>`;
          });
          questionsHTML += "</ol>";
        } else {
          questionsHTML = `<p>${task.content}</p>`;
        }

        card.innerHTML = `
          <h3>${task.subject}: ${task.topic}</h3>
          <div class="assignment-questions">${questionsHTML}</div>
          <p><strong>Deadline:</strong> ${task.deadline || "Not specified"}</p>

          <form class="assignment-form" id="form-${index}">
            <input type="hidden" name="student_name" value="${storedUser.fullName}">
            <input type="hidden" name="student_email" value="${storedUser.email}">
            <input type="hidden" name="subject" value="${task.subject}">
            <input type="hidden" name="topic" value="${task.topic}">
            <label>Upload Answer:</label>
            <input type="file" name="file" accept="image/*,.pdf" required>
            <button type="submit">Submit</button>
          </form>
        `;

        container.appendChild(card);

        // üéØ Handle submission
        const form = card.querySelector(`#form-${index}`);
        form.addEventListener("submit", function(e) {
          e.preventDefault();
          emailjs.sendForm("YOUR_SERVICE_ID", "YOUR_TEMPLATE_ID", this)
            .then(() => alert("‚úÖ Assignment submitted successfully!"))
            .catch(err => alert("‚ùå Error submitting: " + err));
        });
      });
    } else {
      container.innerHTML = "<p>No assignments available at the moment.</p>";
    }

    // ‚úÖ Logout function
    function logout() {
      localStorage.removeItem("loggedInUser");
      window.location.href = "student-login.html";
    }
  </script>
</body>
</html>